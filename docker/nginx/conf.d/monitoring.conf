# Monitoring and Observability Configuration for WP-AutoHealer
# This file contains monitoring endpoints and logging configuration

# Security Monitoring - Log suspicious activities
map $request_uri $suspicious_request {
    default 0;
    ~*\.(php|asp|aspx|jsp)$ 1;
    ~*(union|select|insert|delete|update|drop|create|alter) 1;
    ~*(<script|javascript:|vbscript:|onload|onerror) 1;
    ~*(etc/passwd|boot\.ini|windows/system32) 1;
    ~*(\.\./|\.\.\\) 1;
}

# Log Format for Security Events
log_format security_log '$remote_addr - $remote_user [$time_local] '
                       '"$request" $status $body_bytes_sent '
                       '"$http_referer" "$http_user_agent" '
                       'suspicious=$suspicious_request '
                       'blocked_agent=$blocked_agent '
                       'blocked_country=$blocked_country '
                       'request_id=$req_id '
                       'upstream_response_time=$upstream_response_time';

# Performance Monitoring Log Format
log_format performance_log '$remote_addr - $remote_user [$time_local] '
                          '"$request" $status $body_bytes_sent '
                          'request_time=$request_time '
                          'upstream_connect_time=$upstream_connect_time '
                          'upstream_header_time=$upstream_header_time '
                          'upstream_response_time=$upstream_response_time '
                          'request_id=$req_id';

# Error Log Configuration
error_log /var/log/nginx/error.log warn;
error_log /var/log/nginx/security.log notice;